<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-R">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel del Docente | Evalúa+</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/docente.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
</head>
<body>
    <header class="header">
        <div class="header-container">
            <a href="index.html" class="logo">
               <span>Evalúa+</span>
            </a>
            <div class="user-info">
                <p id="user-name">Bienvenido, cargando...</p>
                <button id="logout-button" class="cta-button secondary">Cerrar Sesión</button>
            </div>
        </div>
    </header>

    <main class="main-container">

        <div id="main-view">
            
            <section class="card">
                <h2>Crear Nueva Clase</h2>
                <form id="create-class-form">
                    <div class="form-grid-2">
                        <div class="input-group">
                            <label for="class-title">Nombre de la Clase</label>
                            <input type="text" id="class-title" name="class-title" placeholder="Ej: Álgebra 10A" required>
                        </div>
                        <div class="input-group">
                            <label for="class-subject">Materia</label>
                            <input type="text" id="class-subject" name="class-subject" placeholder="Ej: Matemáticas" required>
                        </div>
                    </div>
                    <button type="submit" class="cta-button">Crear Clase</button>
                </form>
            </section>
            <section class="card">
                <h2>Crear Nueva Sala de Evaluación</h2>
                <form id="create-room-form">
                    <div class="form-grid-2">
                        <div class="input-group">
                            <label for="title">Título de la Evaluación</label>
                            <input type="text" id="title" name="title" placeholder="Ej: Examen Parcial de Álgebra" required>
                        </div>
                        <div class="input-group">
                            <label for="subject">Materia</label>
                            <input type="text" id="subject" name="subject" placeholder="Ej: Matemáticas" required>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label for="assign-to-classes">Asignar a Clases (Opcional)</label>
                        <select id="assign-to-classes" name="assign-to-classes" multiple>
                            <option value="" disabled>Cargando clases...</option>
                        </select>
                        <small>Mantén presionado Ctrl (o Cmd) para seleccionar varias. Si no seleccionas ninguna, la sala solo será accesible por código.</small>
                    </div>
                    <div class="input-group">
                        <label for="time-limit">Límite de Tiempo (en minutos)</label>
                        <input type="number" id="time-limit" name="time-limit" placeholder="Opcional: Ej: 45">
                        <small>Deja en blanco o en 0 para no establecer un límite de tiempo.</small>
                    </div>
                    <button type="submit" class="cta-button">Crear Sala</button>
                </form>
            </section>

            <section class="card">
                <h2>Mis Clases</h2>
                <div id="classes-list" class="rooms-grid"> <p>Aún no has creado ninguna clase.</p>
                </div>
            </section>
            <section class="card">
                <h2>Mis Salas Creadas</h2>
                <div id="rooms-list" class="rooms-grid">
                    <p>Aún no has creado ninguna sala.</p>
                </div>
            </section>
        </div>

        <div id="results-view" style="display: none;">
            <section class="card">
                <div class="results-header">
                    <h2 id="results-title">Resultados de la Evaluación</h2>
                    <div>
                        <button id="export-csv-btn" class="cta-button">Exportar a CSV</button>
                        <button class="cta-button secondary back-to-main">Volver</button>
                    </div>
                </div>
                <div id="results-list">
                </div>
            </section>
        </div>

        <div id="analytics-view" style="display: none;">
            <section class="card">
                <div class="analytics-header">
                    <h2 id="analytics-title">Analíticas de la Evaluación</h2>
                    <button class="cta-button secondary back-to-main">Volver a Mis Salas</button>
                </div>

                <div class="charts-container">
                    
                    <div class="chart-wrapper">
                        <h3>Resumen de Aprobación</h3>
                        <div class="chart-container" style="max-height: 350px; position: relative; margin: 0 auto; max-width: 350px;">
                            <canvas id="summary-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-wrapper">
                        <h3>Rendimiento por Pregunta (Aciertos vs. Fallos)</h3>
                        <div class="chart-container" style="max-height: 500px; position: relative;">
                            <canvas id="question-performance-chart"></canvas>
                        </div>
                    </div>
                </div>

            </section>
        </div>

            </section>
        </div>

        <div id="manage-questions-view" style="display: none;">
            <section class="card">
                <div class="questions-header">
                    <h2 id="questions-title">Gestionando Evaluación</h2>
                    <div>
                        <button id="add-from-bank-btn" class="cta-button secondary">Añadir desde mi Banco</button>
                        <button id="add-new-question-btn" class="cta-button">Añadir Nueva Pregunta</button>
                        <button class="cta-button secondary back-to-main">Volver a Mis Salas</button>
                    </div>
                </div>
                <div id="questions-list-container">
                    </div>
            </section>
        </div>

    </main>
    
    <div id="add-question-modal" class="modal-overlay">
        <div class="modal-content">
            <form id="add-question-form">
                <h2 id="modal-title">Añadir Nueva Pregunta</h2>
                
                <div class="input-group">
                    <label for="question-text">Texto de la Pregunta</label>
                    <textarea id="question-text" rows="3" required></textarea>
                </div>

                <div class="input-group">
                    <label for="question-type">Tipo de Pregunta</label>
                    <select id="question-type" name="question-type">
                        <option value="multipleChoice">Opción Múltiple (A, B, C, D)</option>
                        <option value="trueFalse">Verdadero o Falso</option>
                        <option value="shortAnswer">Respuesta Corta (Texto Exacto)</option>
                    </select>
                </div>

                <div id="options-multiple-choice">
                    <div class="options-group">
                        <div class="input-group">
                            <label for="option-a">Opción A</label>
                            <input type="text" id="option-a" required>
                        </div>
                        <div class="input-group">
                            <label for="option-b">Opción B</label>
                            <input type="text" id="option-b" required>
                        </div>
                        <div class="input-group">
                            <label for="option-c">Opción C</label>
                            <input type="text" id="option-c" required>
                        </div>
                        <div class="input-group">
                            <label for="option-d">Opción D</label>
                            <input type="text" id="option-d" required>
                        </div>
                    </div>
                </div>

                <div id="options-true-false" style="display: none;">
                    <div class="options-group">
                        <div class="input-group">
                            <label for="option-a-tf">Opción A (Verdadero)</label>
                            <input type="text" id="option-a-tf" value="Verdadero" readonly>
                        </div>
                        <div class="input-group">
                            <label for="option-b-tf">Opción B (Falso)</label>
                            <input type="text" id="option-b-tf" value="Falso" readonly>
                        </div>
                    </div>
                </div>

                <div id="options-short-answer" style="display: none;">
                    <div class="input-group">
                        <label for="correct-answer-sa">Respuesta Correcta (Exacta)</label>
                        <input type="text" id="correct-answer-sa" placeholder="El estudiante debe escribir esto exactamente..." >
                        <small>La calificación es sensible a mayúsculas, minúsculas y espacios.</small>
                    </div>
                </div>

                <div class="input-group" id="correct-answer-radios">
                    <label>Respuesta Correcta</label>
                    <div id="correct-answer-mc" class="correct-answer-selector">
                        <label><input type="radio" name="correct-answer" value="A" checked> A</label>
                        <label><input type="radio" name="correct-answer" value="B"> B</label>
                        <label><input type="radio" name="correct-answer" value="C"> C</label>
                        <label><input type="radio" name="correct-answer" value="D"> D</label>
                    </div>
                    <div id="correct-answer-tf" class="correct-answer-selector" style="display: none;">
                        <label><input type="radio" name="correct-answer-tf" value="A" checked> Verdadero</label>
                        <label><input type="radio" name="correct-answer-tf" value="B"> Falso</label>
                    </div>
                </div>

                <div class="input-group">
                    <label for="feedback-correct">Feedback (si la respuesta es correcta)</label>
                    <textarea id="feedback-correct" rows="2" placeholder="Ej: ¡Correcto! Esta es la razón..."></textarea>
                </div>

                <div class="input-group">
                    <label for="feedback-incorrect">Feedback (si la respuesta es incorrecta)</label>
                    <textarea id="feedback-incorrect" rows="2" placeholder="Ej: La respuesta correcta es C porque..."></textarea>
                </div>

                <div class="input-group save-to-bank-group">
                    <input type="checkbox" id="save-to-bank">
                    <label for="save-to-bank">Guardar en mi Banco de Preguntas</label>
                </div>

                <div class="modal-actions">
                    <button type="button" id="cancel-question-btn" class="cta-button secondary">Cancelar</button>
                    <button type="submit" id="save-question-btn" class="cta-button">Guardar Pregunta</button>
                </div>
            </form>
        </div>
    </div>

    <div id="bank-modal" class="modal-overlay">
        <div class="modal-content">
            <h2>Mi Banco de Preguntas</h2>
            
            <div class="bank-filters">
                <div class="input-group">
                    <label for="subject-filter">Filtrar por Materia</label>
                    <select id="subject-filter">
                        <option value="all">Todas las materias</option>
                    </select>
                </div>
            </div>

            <div id="bank-questions-list" class="bank-questions-list">
                <p>Cargando preguntas...</p>
            </div>

            <div class="modal-actions">
                <button type="button" id="cancel-bank-btn" class="cta-button secondary">Cancelar</button>
                <button type="button" id="add-selected-questions-btn" class="cta-button">Añadir Seleccionadas</button>
            </div>
        </div>
    </div>

    <div id="confirm-delete-modal" class="modal-overlay">
        <div class="modal-content confirm-modal">
            <h2 id="confirm-modal-title">¿Estás seguro?</h2>
            <p id="confirm-modal-text">Esta acción no se puede deshacer.</p>
            <div class="modal-actions">
                <button type="button" id="cancel-delete-btn" class="cta-button secondary">Cancelar</button>
                <button type="button" id="confirm-delete-btn" class="cta-button danger">Confirmar Eliminación</button>
            </div>
        </div>
    </div>

    <script type="module" src="js/firebase-config.js"></script>
    <script type="module" src="js/docente.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
</body>
</html>